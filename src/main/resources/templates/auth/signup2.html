<!DOCTYPE html>
<html class="light" lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Sign Up Information - RE: GO</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13ec5b",
                        "background-light": "#f6f8f6",
                        "background-dark": "#102216",
                        "surface-light": "#ffffff",
                        "surface-dark": "#182c20",
                        "text-main": "#111813",
                        "text-muted": "#61896f",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "Noto Sans KR", "sans-serif"],
                        "body": ["Plus Jakarta Sans", "Noto Sans KR", "sans-serif"],
                    },
                    borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px"},
                },
            },
        }
    </script>
    <style>
        .form-input {
            width: 100%;
            height: 3rem;
            border-radius: 0.5rem;
            border-width: 1px;
            padding-left: 1rem;
            padding-right: 1rem;
            font-size: 1rem;
            line-height: 1.5;
            transition: all 0.2s;
            outline: none;
        }
        .form-input:focus {
            border-color: #13ec5b;
            box-shadow: 0 0 0 1px #13ec5b;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-main dark:text-white transition-colors duration-200">
<div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
    <header class="flex items-center justify-between whitespace-nowrap px-6 lg:px-10 py-6 w-full bg-transparent">
        <div class="flex items-center gap-4 text-text-main dark:text-white cursor-pointer w-full">
            <a class="text-text-muted dark:text-gray-400 text-sm font-medium leading-normal hover:text-primary transition-colors flex items-center gap-1" href="/login">
                <span class="material-symbols-outlined text-lg">arrow_back</span>
                ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </a>
        </div>
    </header>
    
    <div class="layout-container flex h-full grow flex-col">
        <div class="flex flex-1 justify-center py-4 px-4 sm:px-6">
            <div class="layout-content-container flex flex-col w-full max-w-[480px] flex-1">
                <div class="flex flex-col items-center justify-center mb-8">
                    <div class="mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-surface-light dark:bg-surface-dark shadow-sm border border-[#f0f4f2] dark:border-[#1f3629]">
                        <span class="text-2xl font-black italic text-primary">RE</span>
                    </div>
                    <p class="text-sm font-medium text-text-muted dark:text-gray-400">ìƒˆë¡œìš´ ì‹œì‘, RE: GOì™€ í•¨ê»˜</p>
                </div>
                
                <div class="flex flex-col gap-3 mb-8">
                    <div class="flex gap-6 justify-between items-end">
                        <span class="text-xs font-medium text-text-muted dark:text-gray-400">ì •ë³´ì…ë ¥</span>
                        <span class="text-xs font-medium text-primary">2/3</span>
                    </div>
                    <div class="rounded-full bg-[#dbe6df] dark:bg-[#1f3629] h-2 overflow-hidden">
                        <div class="h-full rounded-full bg-primary transition-all duration-500 ease-out" style="width: 66%;"></div>
                    </div>
                </div>

                <div class="mb-8 text-center sm:text-left">
                    <h1 class="text-text-main dark:text-white tracking-tight text-[28px] sm:text-[32px] font-bold leading-tight">
                        ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
                    </h1>
                    <p class="mt-3 text-sm text-text-muted dark:text-gray-400">
                        ì •í™•í•œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì—¬ íšŒì›ê°€ì…ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.
                    </p>
                </div>

                <form action="/signup/step2" method="post">
                    <div class="flex flex-col gap-5">
                        <div class="flex justify-center mb-2">
                            <div class="relative group cursor-pointer">
                                <div class="w-24 h-24 rounded-full bg-surface-light dark:bg-surface-dark border-2 border-dashed border-[#dbe6df] dark:border-[#2a4032] flex items-center justify-center overflow-hidden hover:border-primary transition-colors">
                                    <span class="material-symbols-outlined text-gray-300 dark:text-gray-600 text-4xl">person</span>
                                </div>
                                <div class="absolute bottom-0 right-0 p-2 bg-surface-light dark:bg-surface-dark rounded-full border border-[#dbe6df] dark:border-[#2a4032] shadow-sm flex items-center justify-center group-hover:border-primary transition-colors">
                                    <span class="material-symbols-outlined text-text-muted dark:text-gray-400 text-sm">camera_alt</span>
                                </div>
                                <input accept="image/*" class="hidden" type="file" name="profileImgFile"/>
                            </div>
                        </div>
                        <div class="flex flex-col gap-1.5">
                            <label class="text-sm font-bold text-text-main dark:text-white">ì´ë©”ì¼</label>
                            <div class="flex gap-2">
                                <input class="form-input bg-surface-light dark:bg-surface-dark border-[#dbe6df] dark:border-[#2a4032] text-text-main dark:text-white" 
                                       placeholder="example@re-go.com" type="email" name="email" required/>
									   <button id="checkEmailBtn" class="whitespace-nowrap px-4 rounded-lg border border-[#dbe6df] dark:border-[#2a4032] bg-surface-light dark:bg-surface-dark font-medium text-sm" type="button">ì¤‘ë³µí™•ì¸</button>
                            </div>
							<span id="emailMessage" class="text-xs mt-1 px-1"></span>
                        </div>

                        <div class="flex flex-col gap-1.5">
                            <label class="text-sm font-bold text-text-main dark:text-white">ë¹„ë°€ë²ˆí˜¸</label>
                            <input class="form-input bg-surface-light dark:bg-surface-dark border-[#dbe6df] dark:border-[#2a4032] text-text-main dark:text-white" 
                                   placeholder="ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨ 8ì ì´ìƒ" type="password" name="password" required/>
                        </div>
						<div class="flex flex-col gap-1.5">
						                           <label class="text-sm font-bold text-text-main dark:text-white">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
						                           <input id="passwordConfirm" class="form-input bg-surface-light dark:bg-surface-dark border-[#dbe6df] dark:border-[#2a4032] text-text-main dark:text-white" 
						                                  placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œ ë²ˆ ë” ì…ë ¥í•´ì£¼ì„¸ìš”" type="password" required/>
														  <span id="pwMessage" class="text-xs mt-1 px-1"></span>
						                       </div>
                        <div class="flex flex-col gap-1.5">
                            <label class="text-sm font-bold text-text-main dark:text-white">ë‹‰ë„¤ì„</label>
                            <input id="nickname" class="form-input bg-surface-light dark:bg-surface-dark border-[#dbe6df] dark:border-[#2a4032] text-text-main dark:text-white" 
                                   placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" type="text" name="nickname" required/>
								   <span id="nicknameError" class="text-xs mt-1 px-1"></span>
                        </div>

                        <div class="flex flex-col gap-1.5">
                            <label class="text-sm font-bold text-text-main dark:text-white">ì´ë¦„</label>
                            <input id="username" class="form-input bg-surface-light dark:bg-surface-dark border-[#dbe6df] dark:border-[#2a4032] text-text-main dark:text-white" 
                                   placeholder="ì‹¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" type="text" name="username" required/>
                        </div>

                        <div class="flex flex-col gap-1.5">
                            <label class="text-sm font-bold text-text-main dark:text-white">íœ´ëŒ€í° ë²ˆí˜¸</label>
                            <div class="flex gap-2">
                                <input class="form-input bg-surface-light dark:bg-surface-dark border-[#dbe6df] dark:border-[#2a4032] text-text-main dark:text-white" 
                                       placeholder="- ì—†ì´ ìˆ«ìë§Œ ì…ë ¥" type="tel" name="phoneNumber" required/>
                                <button id="sendAuthBtn" class="whitespace-nowrap px-4 rounded-lg border border-[#dbe6df] dark:border-[#2a4032] bg-surface-light dark:bg-surface-dark font-medium text-sm" type="button">ì¸ì¦ë²ˆí˜¸ ë°›ê¸°</button>
                            </div>
                        </div>

						<div id="authCodeContainer" class="hidden flex flex-col gap-1.5 mt-2">
						    <label class="text-sm font-bold text-text-main dark:text-white">ì¸ì¦ë²ˆí˜¸ í™•ì¸</label>
						    <div class="flex gap-2">
								<input class="form-input bg-surface-light dark:bg-surface-dark border-[#dbe6df] dark:border-[#2a4032] text-text-main dark:text-white" 
								                                       placeholder="6ìë¦¬ ìˆ«ì ì…ë ¥" type="text" name="authCode"/>
						        <button class="whitespace-nowrap px-4 rounded-lg border border-[#dbe6df] dark:border-[#2a4032] bg-surface-light dark:bg-surface-dark font-medium text-sm" type="button">í™•ì¸</button>
						    </div>
						</div>
						
                        <div class="flex flex-col gap-1.5">
                            <label class="text-sm font-bold text-text-main dark:text-white">ì„±ë³„</label>
                            <div class="flex gap-2">
                                <label class="flex-1 cursor-pointer">
                                    <input class="peer sr-only" name="gender" type="radio" value="M"/>
                                    <div class="h-12 flex items-center justify-center rounded-lg border border-[#dbe6df] dark:border-[#2a4032] peer-checked:border-primary peer-checked:text-primary transition-all font-medium text-sm">ë‚¨ì„±</div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input class="peer sr-only" name="gender" type="radio" value="F"/>
                                    <div class="h-12 flex items-center justify-center rounded-lg border border-[#dbe6df] dark:border-[#2a4032] peer-checked:border-primary peer-checked:text-primary transition-all font-medium text-sm">ì—¬ì„±</div>
                                </label>
                            </div>
                        </div>

                        <div class="flex flex-col gap-1.5">
                            <label class="text-sm font-bold text-text-main dark:text-white">ìƒë…„ì›”ì¼</label>
                            <input class="form-input bg-surface-light dark:bg-surface-dark border-[#dbe6df] dark:border-[#2a4032] text-text-main dark:text-white" 
                                   maxlength="8" placeholder="ìƒë…„ì›”ì¼ 8ìë¦¬ (ì˜ˆ: 19990101)" type="text" name="birthDate"/>
                        </div>
                    </div>

                    <div class="mt-8">
                        <button type="submit" class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-xl h-14 px-5 bg-primary hover:bg-[#0fd951] active:scale-[0.98] transition-all duration-200 text-[#111813] text-base font-bold shadow-lg">
                            <span class="truncate">ê°€ì… ì™„ë£Œ</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <footer class="py-6 text-center">
            <p class="text-text-muted dark:text-gray-600 text-xs font-medium">Â© 2024 RE: GO. All rights reserved.</p>
        </footer>
    </div>
</div>
<script>
	let isEmailVerified = false; 
	    let isAuthVerified = false;  

	    const signupForm = document.querySelector('form');
	    const emailInput = document.querySelector('input[name="email"]');
	    const emailMessage = document.getElementById('emailMessage');
	    const passwordInput = document.querySelector('input[name="password"]');
	    const passwordConfirm = document.getElementById('passwordConfirm');
	    const pwMessage = document.getElementById('pwMessage');
	    const nameInput = document.getElementById('username');
	    const nicknameInput = document.getElementById('nickname');
	    const nicknameError = document.getElementById('nicknameError');
	    const phoneInput = document.querySelector('input[name="phoneNumber"]');
	    const birthInput = document.querySelector('input[name="birthDate"]');
	    const authCodeInput = document.querySelector('input[name="authCode"]');
	    const sendAuthBtn = document.getElementById('sendAuthBtn');
	    const authCodeContainer = document.getElementById('authCodeContainer');

	    // 1. ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
	    document.getElementById('checkEmailBtn').addEventListener('click', () => {
	        const email = emailInput.value;
	        if(!email) {
	            emailMessage.textContent = "ì´ë©”ì¼ì„ ë¨¼ì € ì…ë ¥í•´ ì£¼ì„¸ìš”.";
	            emailMessage.style.color = "red";
	            return;
	        }
	        fetch(`/signup/check-email?email=${email}`)
	            .then(res => res.json())
	            .then(isTaken => {
	                if(isTaken) {
	                    emailMessage.textContent = "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì´ì—ìš”. ã… ã… ";
	                    emailMessage.style.color = "red";
	                    isEmailVerified = false;
	                } else {
	                    emailMessage.textContent = "ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ğŸ˜Š";
	                    emailMessage.style.color = "#13ec5b";
	                    isEmailVerified = true;
	                }
	            });
	    });

	    emailInput.addEventListener('input', () => {
	        isEmailVerified = false;
	        emailMessage.textContent = "ìˆ˜ì • ì‹œ ë‹¤ì‹œ ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.";
	        emailMessage.style.color = "orange";
	    });

	    // 2. ë¹„ë°€ë²ˆí˜¸ ì‹¤ì‹œê°„ ì²´í¬
	    const checkPasswords = () => {
	        const pw = passwordInput.value;
	        const pw2 = passwordConfirm.value;
	        if (pw.length > 0 && pw.length < 8) {
	            pwMessage.textContent = "ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ìë¦¬ ì´ìƒì´ì–´ì•¼ í•´ìš”! âŒ";
	            pwMessage.style.color = "red";
	            return false;
	        }
	        if (pw2.length > 0) {
	            if (pw === pw2) {
	                pwMessage.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ê³  ì•ˆì „í•©ë‹ˆë‹¤. âœ…";
	                pwMessage.style.color = "#13ec5b";
	                return true;
	            } else {
	                pwMessage.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì•„ìš”. âŒ";
	                pwMessage.style.color = "red";
	                return false;
	            }
	        } else {
	            pwMessage.textContent = "";
	            return pw.length >= 8;
	        }
	    };
	    passwordInput.addEventListener('input', checkPasswords);
	    passwordConfirm.addEventListener('input', checkPasswords);

	    // 3. ì´ë¦„(username) ê´€ë¦¬
	    nameInput.addEventListener('input', (e) => {
	        e.target.value = e.target.value.replace(/[^ã„±-ã…ã…-ã…£ê°€-í£]/g, '');
	    });

	    // 4. ë‹‰ë„¤ì„ ì‹¤ì‹œê°„ ì¤‘ë³µ ì²´í¬
	    nicknameInput.addEventListener('input', () => {
	        const nickname = nicknameInput.value.trim();
	        if (!nickname) {
	            nicknameError.textContent = "";
	            return;
	        }
	        if (nickname.length < 2) {
	            nicknameError.textContent = "ë‹‰ë„¤ì„ì€ ìµœì†Œ 2ì ì´ìƒ ì‘ì„±í•´ì£¼ì„¸ìš”";
	            nicknameError.style.color = "red";
	            return;
	        }

	        fetch(`/signup/check-nickname?nickname=${encodeURIComponent(nickname)}`)
	            .then(res => res.json())
	            .then(isTaken => {
	                // ì„œë²„ì—ì„œ ì˜¤ëŠ” ê°’ì´ true/falseì¸ì§€ í™•ì‹¤íˆ ì²´í¬
	                if (isTaken === true) {
	                    nicknameError.textContent = "ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤.";
	                    nicknameError.style.color = "red";
	                } else {
	                    nicknameError.textContent = "ì‚¬ìš©ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤!";
	                    nicknameError.style.color = "green";
	                }
	            })
	            .catch(err => console.error("ì„œë²„ í†µì‹  ì—ëŸ¬!", err));
	    });

	    // 5. íœ´ëŒ€í° ì¸ì¦ ë° í•˜ì´í”ˆ ìë™ ì‚½ì…
	    sendAuthBtn.addEventListener('click', () => {
	        const phone = phoneInput.value;
	        if(phone.length < 10) {
	            alert('íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”!');
	            return;
	        }
	        alert('ì¸ì¦ë²ˆí˜¸ 123456ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤! (í…ŒìŠ¤íŠ¸ìš©)');
	        authCodeContainer.classList.remove('hidden');
	    });

	    authCodeContainer.querySelector('button').addEventListener('click', (e) => {
	        e.preventDefault();
	        if(authCodeInput.value === "123456") {
	            alert("ì¸ì¦ ì„±ê³µ! âœ…");
	            isAuthVerified = true;
	            authCodeInput.readOnly = true;
	        } else {
	            alert("ì¸ì¦ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”. âŒ");
	        }
	    });

	    phoneInput.addEventListener('input', (e) => {
	        let val = e.target.value.replace(/[^0-9]/g, '');
	        if (val.length > 3 && val.length <= 7) val = val.slice(0, 3) + '-' + val.slice(3);
	        else if (val.length > 7) val = val.slice(0, 3) + '-' + val.slice(3, 7) + '-' + val.slice(7, 11);
	        e.target.value = val;
	    });

	    // 6. ìµœì¢… ì „ì†¡ ì‹œ ìœ íš¨ì„± ê²€ì‚¬ 
	    signupForm.addEventListener('submit', (e) => {
	        console.log("ê°€ì… ì œì¶œ ì‹œë„ ì¤‘...");
	        const birthReg = /^(19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])$/;
	        const nameRegex = /^[ê°€-í£]{2,5}$/; 
	        const nameValue = nameInput.value;
	        const genderSelected = document.querySelector('input[name="gender"]:checked');

	        if (!isEmailVerified) { e.preventDefault(); alert("ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ì´ í•„ìš”í•´ìš”!"); return; }
	        if (!checkPasswords()) { e.preventDefault(); alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”!"); return; }
	        
	        // ì´ë¦„ ë¹ŒëŸ° ì°¨ë‹¨ (ì˜¤íƒ€ ìˆ˜ì •ëœ ë¶€ë¶„!)
	        if (!nameRegex.test(nameValue)) {
	            alert("ì´ë¦„ì€ ì™„ì„±ëœ í•œê¸€ 2~5ìë¦¬ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”! (ê¿»ê¿» ê¸ˆì§€)");
	            e.preventDefault();
	            nameInput.focus();
	            return;
	        }
	        
	        if (!isAuthVerified) { e.preventDefault(); alert("íœ´ëŒ€í° ì¸ì¦ì„ ì™„ë£Œí•´ ì£¼ì„¸ìš”!"); return; }
	        if (!genderSelected) { e.preventDefault(); alert("ì„±ë³„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!"); return; }
	        if (!birthReg.test(birthInput.value)) {
	            e.preventDefault();
	            alert("ìƒë…„ì›”ì¼ 8ìë¦¬ë¥¼ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš” (ì˜ˆ: 19950520).");
	            return;
	        }
	    });
	</script>
</body>
</html>
