<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.SellerInfoMapper">

    <!-- =========================================
         판매자 정보 조회 (상품 상세용)
         DETAIL01_SELLER_INFO
    ========================================== -->
    <select id="selectSellerInfoByProductId"
        parameterType="java.lang.Long"
        resultType="com.itwillbs.dto.SellerInfoDTO">

    SELECT
        u.user_id    AS sellerId,
        u.nickname   AS nickname,
        u.created_at AS joinedAt,

        COUNT(
            CASE
                WHEN p.sales_status = 'ON_SALE' THEN 1
            END
        ) AS sellingCount,

        COUNT(
            CASE
                WHEN p.sales_status = 'SOLD' THEN 1
            END
        ) AS soldCount

    FROM products pr
    JOIN users u
      ON pr.seller_id = u.user_id
    LEFT JOIN products p
      ON p.seller_id = u.user_id

    WHERE pr.product_id = #{productId}

    GROUP BY
        u.user_id,
        u.nickname,
        u.created_at
</select>


</mapper>
