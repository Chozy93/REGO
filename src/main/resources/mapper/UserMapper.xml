<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.UserMapper">

    <select id="findSocialAccount" resultType="com.itwillbs.dto.SocialAccountDTO">
        SELECT 
            social_id AS socialId, 
            connected_at AS connectedAt, 
            provider, 
            provider_id AS providerId, 
            user_id AS userId
        FROM social_accounts 
        WHERE provider = #{provider} AND provider_id = #{providerId}
    </select>

    <insert id="insertUser" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO users (username, nickname, role)
        VALUES (#{username}, #{nickname}, 'ROLE_USER')
    </insert>

    <insert id="insertSocialAccount">
        INSERT INTO social_accounts (
            social_id, 
            connected_at, 
            provider, 
            provider_id, 
            user_id
        )
        VALUES (
            #{socialId}, 
            NOW(), 
            #{provider}, 
            #{providerId}, 
            #{userId}
        )
    </insert>

</mapper>